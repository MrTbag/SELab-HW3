# گزارش تمرین TDD – ShoppingCart

## مشخصات دانشجو
- نام و نام خانوادگی: محمدمهدی اکبر
- شماره دانشجویی: 400104726
- تمرین: ایجاد مبتنی بر آزمون (TDD)

---

## توضیح کلی پروژه
در این تمرین، یک پروژه‌ی اولیه‌ی Java با نام **ShoppingCart** در اختیار قرار گرفت.
هدف تمرین، تمرین مفاهیم **توسعه مبتنی بر تست (TDD)**، شناسایی و اصلاح یک باگ منطقی،
پیاده‌سازی یک قابلیت جدید با چرخه‌ی TDD، و در نهایت افزایش **پوشش تست‌ها (Test Coverage)** بود.

تمام مراحل توسعه به صورت گام‌به‌گام انجام شده و برای هر تغییر، کامیت جداگانه در Git ثبت شده است.

---

## محیط توسعه و ابزارها
- زبان برنامه‌نویسی: Java
- نسخه Java: Java 11
- محیط توسعه: IntelliJ IDEA Community Edition
- فریم‌ورک تست: JUnit 4
- کنترل نسخه: Git + GitHub
- مدیریت کارها: Kanban Board (GitHub Projects)

---

## اجرای اولیه تست‌ها (Baseline)
در ابتدای پروژه و بدون هیچ تغییری در کد، تمامی تست‌های موجود اجرا شدند تا وضعیت اولیه پروژه بررسی شود.

نتیجه:
- تمام تست‌ها **Pass** شدند
- پروژه در وضعیت پایدار اولیه قرار داشت

**اسکرین‌شات اجرای اولیه تست‌ها:**
![baseline-tests](initial%20test.png)


---

## بخش 1: شناسایی و اصلاح باگ تخفیف

### Q1) باگ موجود در پروژه چه بود؟
در متد `getTotalWithDiscount`، شرط اعمال تخفیف به صورت زیر نوشته شده بود:

```java
if (total >= 100)
```

در حالی که طبق توضیح مسئله، تخفیف باید فقط زمانی اعمال شود که مجموع خرید
**بزرگتر از 100** باشد، نه مساوی آن.

---

### Q2) چرا این باگ قبلاً شناسایی نشده بود؟
زیرا در تست‌های اولیه، تست درستی برای بررسی حالت مرزی مقدار **دقیقاً برابر با 100**
وجود نداشت یا انتظار تست‌ها با نیازمندی واقعی سیستم هم‌خوانی نداشت.

---

### مرحله RED: اضافه کردن تست صحیح برای حالت مرزی
یک تست جدید اضافه شد که بررسی می‌کرد اگر مجموع خرید دقیقاً برابر با 100 باشد،
نباید تخفیفی اعمال شود.
این تست در وضعیت اولیه پروژه **Fail** شد و وجود باگ را آشکار کرد.

**اسکرین‌شات تست Fail (RED):**
![discount-boundary-red](add%20failing%20test.png)

---

### مرحله GREEN: اصلاح کد
شرط اعمال تخفیف به شکل زیر اصلاح شد:

```java
if (total > 100)
```

پس از این تغییر، تست جدید و سایر تست‌ها با موفقیت **Pass** شدند.

**اسکرین‌شات تست Pass (GREEN):**
![discount-boundary-green](correct%20the%20discount%20condition.png)

---

### توضیح تست اشتباه موجود در پروژه اولیه
در پروژه‌ی اولیه، تستی با نام `testDiscountAtBoundary_WRONG` وجود داشت که به اشتباه
انتظار داشت در صورت برابر بودن مجموع خرید با 100، تخفیف اعمال شود.
با توجه به نیازمندی مسئله، این تست ذاتاً نادرست بوده و هدف آن هم اشاره به این اشتباه در نوشتن کد بود.

---

### Q3) به نظر شما و بر اساس تجربه‌ی به‌دست‌آمده، نوشتن آزمون پس از نوشتن برنامه چه مشکلاتی را می‌تواند بسازد؟
- نوشتن تست قبل از کد باعث می‌شود **نیازمندی‌ها دقیق و قابل‌سنجش** شوند و از همان ابتدا ابهام‌ها (مانند شرایط مرزی) شناسایی شوند؛ در حالی که نوشتن تست بعد از کد می‌تواند این خطاها را پنهان کند.
- تست‌ها به‌عنوان یک **شبکه‌ی ایمنی** عمل می‌کنند و هنگام اصلاح باگ یا ریفکتور کردن کد، به‌سرعت نشان می‌دهند که آیا تغییری ناخواسته در رفتار سیستم ایجاد شده است یا خیر.
- رویکرد TDD طراحی کد را به سمت **سادگی و تست‌پذیری بیشتر** هدایت می‌کند، در حالی که نوشتن تست پس از کدنویسی معمولاً منجر به کدهای پیچیده و سخت‌تر برای تست می‌شود.

---

## بخش 2: پیاده‌سازی متد updateItemPrice با TDD

### مراحل انجام TDD
پیاده‌سازی متد `updateItemPrice` دقیقاً طبق چرخه‌ی TDD انجام شد:

1. **RED**
   تست‌های مربوط به این متد که در پروژه کامنت شده بودند، فعال شدند و تست‌ها Fail شدند.
2. **GREEN**
   پیاده‌سازی حداقلی انجام شد تا تست‌ها Pass شوند.
3. **REFACTOR**
   کد بدون تغییر رفتار، ساده‌تر و تمیزتر شد و تست‌ها دوباره اجرا شدند.

**اسکرین‌شات مراحل TDD (RED / GREEN):**
Failed
![update-red](test%20enableItemPrice%20failed.png)
Passed
![update-green](test%20enableItemPrice%20passed.png)
Refactored
![update-green](test%20enableItemPrice%20passed%20after%20refactoring.png)
---

### رفتار نهایی متد updateItemPrice
- اگر آیتم وجود داشته باشد: قیمت آن به‌روزرسانی می‌شود
- تعداد آیتم‌ها تغییر نمی‌کند
- اگر آیتم وجود نداشته باشد: هیچ تغییری ایجاد نمی‌شود

---
### Q4) نوشتن موارد آزمون پیش از کدنویسی چگونه کار ساخت برنامه را نسبت به روش قبلی که در بخش قبل انجام داده‌اید تسهیل کرد؟
نوشتن تست‌ها پیش از کدنویسی باعث شد مسیر پیاده‌سازی از ابتدا **شفاف و هدفمند** باشد و توسعه‌دهنده دقیقاً بداند چه رفتاری باید پیاده‌سازی شود.  
این رویکرد از پیاده‌سازی‌های اضافی یا اشتباه جلوگیری کرد و تمرکز توسعه فقط روی پاس شدن تست‌ها قرار گرفت.  
همچنین خطاهای منطقی و شرایط مرزی بسیار زودتر از روش سنتی شناسایی شدند.

---

### Q5) در نهایت، به نظر شما روش ایجاد مبتنی بر آزمون چه مزایا و معایبی دارد؟
از مزایای TDD می‌توان به **کاهش باگ‌ها، افزایش اطمینان به کد، بهبود طراحی و امکان ریفکتور امن** اشاره کرد.  
همچنین وجود تست‌های خودکار باعث می‌شود تغییرات آینده سریع‌تر و مطمئن‌تر انجام شوند.  
در مقابل، این روش در ابتدا **زمان‌برتر** است و نیاز به تفکر و طراحی بیشتری دارد که ممکن است برای پروژه‌های بسیار کوچک یا زمان‌محدود مناسب نباشد.

---

## Q6) افزایش پوشش تست (Test Coverage)

### پوشش تست قبل از افزودن تست‌های جدید
پیش از اضافه کردن تست‌های لبه‌ای:

- Line Coverage فایل `ShoppingCart.java`: **93% (14 از 15 خط)**
- Branch Coverage: **83% (5 از 6 شاخه)**

**اسکرین‌شات Coverage قبل از تغییرات:**
![coverage-before](initial%20coverage.png)

---

### پوشش تست بعد از افزودن تست‌های جدید
پس از اضافه کردن تست‌های تکمیلی:

- Line Coverage فایل `ShoppingCart.java`: **100% (15 از 15 خط)**
- Branch Coverage: **100% (6 از 6 شاخه)**

**اسکرین‌شات Coverage بعد از تغییرات:**
![coverage-after](final%20coverage.png)

---

### بخش‌هایی که با تست‌های جدید پوشش داده شدند
تست‌های اضافه‌شده باعث پوشش کامل موارد زیر شدند:
- حالت مرزی مقدار دقیق 100 برای تخفیف
- اعمال تخفیف برای مقادیر کمی بزرگ‌تر از 100
- رفتار سبد خرید خالی
- حذف آیتمی که وجود ندارد
- تمامی شاخه‌های شرطی (if / else)

---

## لیست کامیت‌ها و توضیح هرکدام
- `chore: import starter ShoppingCart project`
  وارد کردن پروژه‌ی اولیه و شروع کنترل نسخه

- `test: add boundary test for no discount at exactly 100`
  اضافه کردن تست صحیح برای حالت مرزی (RED)

- `fix: apply discount only when total > 100`
  اصلاح منطق تخفیف (GREEN)

- `test: correct wrong boundary discount test to match requirement`
  اصلاح تست اشتباه موجود در پروژه اولیه

- `test: enable updateItemPrice test cases (TDD red)`
  فعال‌سازی تست‌های updateItemPrice (RED)

- `feat: implement updateItemPrice to update existing item only`
  پیاده‌سازی حداقلی متد (GREEN)

- `refactor: simplify updateItemPrice implementation`
  تمیزسازی کد بدون تغییر رفتار

- `test: add edge-case tests to improve ShoppingCart coverage`
  اضافه کردن تست‌های لبه‌ای برای افزایش پوشش

- `docs: document test coverage improvement before and after`
  مستندسازی گزارش نهایی

---

## نتیجه‌گیری
در این تمرین:
- یک باگ منطقی واقعی شناسایی و اصلاح شد
- یک قابلیت جدید با رویکرد TDD پیاده‌سازی شد
- پوشش تست‌ها به 100٪ افزایش یافت
- اهمیت تست‌های لبه‌ای و صحت نیازمندی‌ها در مقابل تست‌های اشتباه نشان داده شد

این تمرین نشان داد که تست‌ها نیز می‌توانند اشتباه باشند و توسعه‌دهنده باید
همواره منطق مسئله و نیازمندی‌ها را معیار اصلی تصمیم‌گیری قرار دهد.
